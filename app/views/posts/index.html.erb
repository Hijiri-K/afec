
<div class="main posts-index">
  <div class="new-post">
    <div class="post-user-name">
      <img src="<%="/user_images/#{@current_user.image_name}"%>" alt="">

      <%=link_to("#{@current_user.name}","/users/#{@current_user.id}/show")%>

    </div>

    <div class="post-info">
      <%if Post.find_by(user_id: @current_user.id)%>
            <%=@mypost.content%>
              i have <%=@mypost.currency_have%>
              <%=@mypost.currency_have_amount%>
              i want <%=@mypost.currency_want%>
              <%=@mypost.currency_want_amount%>
              <!-- location
              緯度<%=@mypost.lat%>
              経度<%=@mypost.lng%> -->

      <%end%>
    </div>

      <!-- <%=form_tag("/posts/create") do%>
    <textarea name="content" rows="2" cols="65"></textarea>
    <input type="submit" name="" value="投稿"> -->
    <!-- <%end%> -->
  </div>


  <div class="container-i">
    <%@posts.each do |post|%>
    <%user = User.find_by(id: post.user_id)%>
    <div class="posts-index-item">
      <%if post.user_id%>
      <div class="post-user-name">
        <img src="<%="/user_images/#{user.image_name}"%>" alt="">

        <%=link_to("#{user.name}","/users/#{user.id}/show")%>

      </div>
      <%end%>
        <%=link_to(simple_format(post.content), "/posts/#{post.id}")%>
        i have <%=post.currency_have%>
        <%=post.currency_have_amount%><br>
        i want <%=post.currency_want%>
        <%=post.currency_want_amount%><br>
        location<br>
        緯度<%=post.lat%><br>
        経度<%=post.lng%><br>


        <%if Post.find_by(user_id: @current_user.id)%>
        <%


        lat1 = post.lat
        lng1 = post.lng
        lat2 = @mypost.lat
        lng2 = @mypost.lng

        y1 = lat1 * Math::PI / 180
        x1 = lng1 * Math::PI / 180
        y2 = lat2 * Math::PI / 180
        x2 = lng2 * Math::PI / 180
        earth_r = 6378140

        deg = Math::sin(y1) * Math::sin(y2) + Math::cos(y1) * Math::cos(y2) * Math::cos(x2 - x1)
        distance = earth_r * (Math::atan(-deg / Math::sqrt(-deg * deg + 1)) + Math::PI / 2)
        # /1000
        %>

          <%end%>

            <%=distance.to_i%>m



        <%if Like.find_by(user_id: @current_user.id, post_id: post.id)%>
          <%=link_to("/likes/#{post.id}/destroy_index", {method:"post"}) do%>
            <span class = "fa fa-heart like"></span>
          <%end%>
        <%else%>
          <%=link_to("/likes/#{post.id}/create_index", {method:"post"}) do%>
            <span class = "fa fa-heart unlike"></span>
          <%end%>
        <%end%>
        <%likes_count = Like.where(post_id: post.id).count%>
        <%=likes_count%>



    </div>
    <%end%>

  </div>
</div>
